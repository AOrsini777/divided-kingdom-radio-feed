<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Divided Kingdom Radio Feed</title>
</head>
<body>
    <h1>Divided Kingdom Radio Episodes</h1>
    <ul id="episode-list"></ul>

    <script>
        function parseDateFromUrl(url) {
            const match = url.match(/(\d{6})(?=\.mp3)/);
            if (!match) return { raw: "Unknown", formatted: "Unknown Date" };

            const raw = match[1]; // e.g., "041224"
            const month = parseInt(raw.slice(0, 2), 10);
            const day = parseInt(raw.slice(2, 4), 10);
            const year = parseInt("20" + raw.slice(4, 6), 10); // assumes 20xx

            const dateObj = new Date(year, month - 1, day);
            const formatted = dateObj.toLocaleDateString(undefined, {
                year: "numeric",
                month: "long",
                day: "numeric"
            });
            return { raw, formatted };
        }

        fetch('feed.xml')
        .then(response => response.text())
        .then(data => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data, "text/xml");
            const items = xmlDoc.getElementsByTagName('item');
            const episodeList = document.getElementById('episode-list');
            const seenFilenames = new Set();

            Array.from(items).forEach(item => {
                const titleEl = item.getElementsByTagName('title')[0];
                const linkEl = item.getElementsByTagName('link')[0];
                if (!linkEl || !titleEl) return;

                const link = linkEl.textContent.trim();
                const filenameMatch = link.match(/([^\/]+\.mp3)/);
                if (!filenameMatch) return;
                const filename = filenameMatch[1];

                if (seenFilenames.has(filename)) return;
                seenFilenames.add(filename);

                const originalTitle = titleEl.textContent;
                const { formatted } = parseDateFromUrl(link);

                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${originalTitle} (${formatted})</strong><br>
                    <a href="${link}" target="_blank">ðŸŽ§ Listen to Episode</a><br><br>
                `;
                episodeList.appendChild(li);
            });
        })
        .catch(error => {
            console.error('Error loading feed:', error);
        });
    </script>
</body>
</html>
